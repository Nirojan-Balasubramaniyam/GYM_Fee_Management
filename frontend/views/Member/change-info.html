<style>
    label {
        display: block;
        margin-bottom: 5px;
        color: #34495e;
    }

    input {
        width: 100%;
        padding: 10px;
        margin-bottom: 15px;
        border: 1px solid #ccc;
        border-radius: 5px;
        font-size: 16px;
    }

    input:focus {
        outline: none;
        border-color: #1abc9c;
    }

    button {
        width: 100%;
        padding: 10px;
        background-color: #1abc9c;
        color: white;
        border: none;
        cursor: pointer;
        border-radius: 5px;
        font-size: 16px;
    }

    button:hover {
        background-color: #16a085;
    }

    #changeInfoCard {
        margin-top: 10px;
        background-color: #ecf0f1;
        max-height: 100vh;
        height: 500px;
        overflow-y: hidden;
        overflow-x: hidden;
        padding: 20px;
        border-radius: 10px;
        /* width: 100%; */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    #content {
        overflow-y: scroll;
    }
    #infoChangeContainer{
        overflow-y: auto;
        max-height: 500px;
    }
</style>

<section id="content">
    <h2 id="contentTitle">Change PErsonal Information</h2>
    <div id="changeInfoCard">
        <div class="row">
            <div class="col-12">
                <div id="infoChangeContainer" class="member-info-card-unique">

                    <form id="memberForm" class="member-form-unique">
                        <label for="firstName" class="form-label-unique">First Name:</label>
                        <input type="text" id="firstName" class="input-field-unique" placeholder="Enter First Name">

                        <label for="lastName" class="form-label-unique">Last Name:</label>
                        <input type="text" id="lastName" class="input-field-unique" placeholder="Enter Last Name">

                        <label for="phone" class="form-label-unique">Phone:</label>
                        <input type="text" id="phone" class="input-field-unique" placeholder="Enter Phone Number">

                        <label for="address" class="form-label-unique">Address:</label>
                        <input type="text" id="address" class="input-field-unique" placeholder="Enter NIC">

                        <label for="emrgncyContactName" class="form-label-unique">EmergencyContactName:</label>
                        <input type="text" id="emrgncyContactName" class="input-field-unique" placeholder="Enter NIC">

                        <label for="emrgncyContactNumber" class="form-label-unique">EmergencyContactNumber:</label>
                        <input type="text" id="emrgncyContactNumber" class="input-field-unique" placeholder="Enter NIC">

                        <!-- <button type="button" id="saveButton" class="btn-unique">Save Changes</button> -->
                    </form>

                    <button type="button" id="changeInfoButton" class="btn-unique">Change Info</button>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    document.addEventListener("DOMContentLoaded", async () => {
        const membersUrl = "http://localhost:7000/Members";
        const approvalRequestsUrl = "http://localhost:7000/ApprovalRequests";
        const lastIdUrl = "http://localhost:7000/LastId";

        let members = [];
        let approvalRequests = [];
        let lastIds = [];

        const memberResponse = await fetch(membersUrl);
        members = await memberResponse.json();

        const lastidsResponse = await fetch(lastIdUrl);
        lastIds = await lastidsResponse.json();

        const approvalResponse = await fetch(approvalRequestsUrl);
        approvalRequests = await approvalResponse.json();

        const member = members.find(member => member.id === loggedInUser.id);
        if (member) {
            document.getElementById('firstName').value = member.FirstName;
            document.getElementById('lastName').value = member.LastName;
            document.getElementById('phone').value = member.Phone;
            document.getElementById('address').value = member.Adress;
            document.getElementById('emrgncyContactName').value = member.EmergencyContactPrsn;
            document.getElementById('emrgncyContactNumber').value = member.EmergencyContact;
        }

        document.getElementById('changeInfoButton').addEventListener('click', async () => {

            const newApprovalRequest = {
                id: generateID("AR", lastIds.ApprovalRequestID),
                RequestType: "changeMemberInfo",
                MemberID: loggedInUser.id,
                FirstName: document.getElementById('firstName').value,
                LastName: document.getElementById('lastName').value,
                Phone: document.getElementById('phone').value,
                Adress:document.getElementById('address').value,
                EmergencyContactPrsn: document.getElementById('emrgncyContactName').value,
                EmergencyContact: document.getElementById('emrgncyContactNumber').value,
                Status: "pending"
            };

            const postResponse = await postApi(approvalRequestsUrl,newApprovalRequest);
            if(postResponse.ok){
                lastIds.ApprovalRequestID++;
                updateLastId(lastIds);
                alert('Your information change request has been sent to admin for approval!');
                location.reload();
            }

        });
    })
</script>