<style>
  #programReportContainer {
    max-height: 100vh;
    height: 600px;
    width: 90%;
    margin: 0 auto;
    font-family: Arial, sans-serif;
    background-color: #f9f9f9;
    border-radius: 8px;
    box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
    
    overflow-y: auto;
  }

  #programReportTitle {
    color: #d32f2f;
    font-weight: bold;
    text-align: center;
    margin-bottom: 20px;
    font-size: 24px;
  }

  #programReportTable {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
    font-size: 16px;
  }
  #programReportTable th{
    position: sticky;
    top: 0;
  }
  #programReportTable th,
  #programReportTable td {
    padding: 12px 15px;
    text-align: left;
    border: 1px solid #ddd;
  }

  .programHeader {
    background-color: #1abc9c;
    color: white;
    text-align: center;
  }

  .percentageHeader {
    background-color: #ff9800;
    color: white;
    text-align: center;
  }

  #programReportTable tbody tr:nth-child(even) {
    background-color: #f9f9f9;
  }

  #programReportTable tbody tr:hover {
    background-color: #f1f1f1;
  }


  #programReportCard {
    margin-top: 50px;
    background-color: #ecf0f1;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  }
</style>
<section id="content">
  <h2 id="contentTitle">Training Programs Report</h2>
  <div id="dynamicContent">
    <div id="programReportCard">
      <div id="programReportContainer">
        <table id="programReportTable">
          <thead>
            <tr>
              <th class="programHeader">Training Programs</th>
              <th class="percentageHeader">Accessing Users Percentage</th>
            </tr>
          </thead>
          <tbody> </tbody>
        </table>
      </div>
    </div>
  </div>
</section>

<script>
  document.addEventListener("DOMContentLoaded", async () => {
    const membersUrl = 'http://localhost:7000/Members';
    const enrolledProgramsUrl = 'http://localhost:7000/EnrolledTrainingPrograms';
    const activitiesUrl = 'http://localhost:7000/TrainingProgramActivities';
    let members = [];
    let enrolledPrograms = [];
    let trainingActivities = [];

    const memberResponse = await fetch(membersUrl);
    members = await memberResponse.json();

    const enrolledResponse = await fetch(enrolledProgramsUrl);
    enrolledPrograms = await enrolledResponse.json();

    const activitiesResponse = await fetch(activitiesUrl);
    trainingActivities = await activitiesResponse.json();

    const displayProgramReport = () => {
      const totalMembers = members.length;
      const tbody = document.querySelector('#programReportTable tbody');
      tbody.innerHTML = '';

      const selectedMembers = [...new Set(enrolledPrograms.map(program => program.MemberID))];
      const selectedMembersPercentage = ((selectedMembers.length / totalMembers) * 100).toFixed(0);

      // const cardioMembers = enrolledPrograms.filter(program =>{
      //                           const activity = trainingActivities.find(activity => activity.id === program.ActivittID);
      //                           return  activity.TypeID === 'P001'});

      let uniqueCardioMembers = [];

      const cardioMembers = enrolledPrograms.filter(program => {
        const activity = trainingActivities.find(activity => activity.id === program.ActivittID);

        // Check if activity is cardio and if the member is not already in the uniqueCardioMembers array
        if (activity && activity.TypeID === 'P001' && !uniqueCardioMembers.includes(program.MemberID)) {
          uniqueCardioMembers.push(program.MemberID);
          return true; // Include this program in the filter result
        }
        return false; // Skip duplicate members
      });

      let uniqueWeightTrainingMembers = [];

      const weightTrainingMembers = enrolledPrograms.filter(program => {
        const activity = trainingActivities.find(activity => activity.id === program.ActivittID);

        // Check if activity is cardio and if the member is not already in the uniqueCardioMembers array
        if (activity && activity.TypeID === 'P002' && !uniqueWeightTrainingMembers.includes(program.MemberID)) {
          uniqueWeightTrainingMembers.push(program.MemberID);
          return true; // Include this program in the filter result
        }
        return false; // Skip duplicate members
      });

      const cardioPercentage = ((uniqueCardioMembers.length / selectedMembers.length) * 100).toFixed(0);
      const weightTrainingPercentage = ((uniqueWeightTrainingMembers.length / selectedMembers.length) * 100).toFixed(0);

      tbody.innerHTML += `
            <tr>
                <td>Total Members</td>
                <td>${totalMembers}</td>
            </tr>
            <tr>
                <td>Training Program Selected Members</td>
                <td>${selectedMembers.length} Memebers (${selectedMembersPercentage}%)</td>
            </tr>
            <tr>
                <td>Cardio</td>
                <td>${cardioMembers.length} Memebers (${cardioPercentage}%)</td>
            </tr>
            <tr>
                <td>Weight Training</td>
                <td>${weightTrainingMembers.length} Memebers (${weightTrainingPercentage}%)</td>
            </tr>
        `;

      const cardioSubPrograms = trainingActivities
        .filter(activity => activity.TypeID === 'P001')
        .map(activity => activity.ActivityName); //  ['Running', 'Cycling', 'Aerobic'];
      cardioSubPrograms.forEach(subProgram => {
        const activityId = getActivityId(subProgram);
        const subProgramMembers = cardioMembers.filter(program => program.ActivittID === activityId);
        const subProgramPercentage = ((subProgramMembers.length / cardioMembers.length) * 100).toFixed(0);

        tbody.innerHTML += `
                <tr>
                    <td>${subProgram}</td>
                    <td>${subProgramMembers.length} Memebers (${subProgramPercentage}%)</td>
                </tr>
            `;
      });

      const weightTrainingSubPrograms = trainingActivities
        .filter(activity => activity.TypeID === 'P002')
        .map(activity => activity.ActivityName);
        console.log(weightTrainingSubPrograms.length)
      weightTrainingSubPrograms.forEach(subProgram => {
        const activityId = getActivityId(subProgram);
        const subProgramMembers = weightTrainingMembers.filter(program => program.ActivittID === activityId);
        const subProgramPercentage = ((subProgramMembers.length / weightTrainingMembers.length) * 100).toFixed(0);

        tbody.innerHTML += `
                <tr>
                    <td>${subProgram}</td>
                    <td>${subProgramMembers.length} Memebers (${subProgramPercentage}%)</td>
                </tr>
            `;
      });
    };

    const getActivityId = (subProgramName) => {
      const activity = trainingActivities.find(activity => activity.ActivityName.toLowerCase() === subProgramName.toLowerCase());
      return activity ? activity.id : null;
    };

    displayProgramReport();
  })
</script>